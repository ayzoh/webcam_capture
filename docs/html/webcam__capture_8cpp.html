<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Webcam_capture: src/webcam_capture.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Webcam_capture
   </div>
   <div id="projectbrief">This program record each frames of a connected webcam, treat it and save it as a  .jpg in img/ directory.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">webcam_capture.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;webcam.h&quot;</code><br />
<code>#include &quot;functions.h&quot;</code><br />
</div>
<p><a href="webcam__capture_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abc91e7fb5a5a6e02a812a21ef487477b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#abc91e7fb5a5a6e02a812a21ef487477b">StopContCapture</a> (int sig_id)</td></tr>
<tr class="memdesc:abc91e7fb5a5a6e02a812a21ef487477b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop capture if sig_int signal is entered.  <a href="webcam__capture_8cpp.html#abc91e7fb5a5a6e02a812a21ef487477b">More...</a><br /></td></tr>
<tr class="separator:abc91e7fb5a5a6e02a812a21ef487477b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac45d9c019293e46f9006d243135510"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#acac45d9c019293e46f9006d243135510">InstallSIGINTHandler</a> ()</td></tr>
<tr class="memdesc:acac45d9c019293e46f9006d243135510"><td class="mdescLeft">&#160;</td><td class="mdescRight">Catch sig_int signal if Ctrl+C is entered.  <a href="webcam__capture_8cpp.html#acac45d9c019293e46f9006d243135510">More...</a><br /></td></tr>
<tr class="separator:acac45d9c019293e46f9006d243135510"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e01bcf6b5022fc7d53e87dea3d93632"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#a5e01bcf6b5022fc7d53e87dea3d93632">frameRead</a> (int fd)</td></tr>
<tr class="memdesc:a5e01bcf6b5022fc7d53e87dea3d93632"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write in a .jpg the saved buffer(frame).  <a href="webcam__capture_8cpp.html#a5e01bcf6b5022fc7d53e87dea3d93632">More...</a><br /></td></tr>
<tr class="separator:a5e01bcf6b5022fc7d53e87dea3d93632"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31d53d917c05d218ff61962df27dc9b4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#a31d53d917c05d218ff61962df27dc9b4">record_loop</a> (int fd)</td></tr>
<tr class="memdesc:a31d53d917c05d218ff61962df27dc9b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capture frames while Ctrl+C is not pressed.  <a href="webcam__capture_8cpp.html#a31d53d917c05d218ff61962df27dc9b4">More...</a><br /></td></tr>
<tr class="separator:a31d53d917c05d218ff61962df27dc9b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5190a40848a190b9b55aa5ccdc9d2f0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#ab5190a40848a190b9b55aa5ccdc9d2f0">start_capture</a> (int fd, int n)</td></tr>
<tr class="memdesc:ab5190a40848a190b9b55aa5ccdc9d2f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start camera record (VIDIOC_STREAMON).  <a href="webcam__capture_8cpp.html#ab5190a40848a190b9b55aa5ccdc9d2f0">More...</a><br /></td></tr>
<tr class="separator:ab5190a40848a190b9b55aa5ccdc9d2f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af82945ba52597baa86591d757c299a68"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#af82945ba52597baa86591d757c299a68">stop_record</a> (int fd)</td></tr>
<tr class="memdesc:af82945ba52597baa86591d757c299a68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop camera record (VIDIOC_STREAMOFF)  <a href="webcam__capture_8cpp.html#af82945ba52597baa86591d757c299a68">More...</a><br /></td></tr>
<tr class="separator:af82945ba52597baa86591d757c299a68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3c43a0316dfc1464879b1bfabb2a340"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#ab3c43a0316dfc1464879b1bfabb2a340">capture</a> (void)</td></tr>
<tr class="memdesc:ab3c43a0316dfc1464879b1bfabb2a340"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function of the project.  <a href="webcam__capture_8cpp.html#ab3c43a0316dfc1464879b1bfabb2a340">More...</a><br /></td></tr>
<tr class="separator:ab3c43a0316dfc1464879b1bfabb2a340"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3651b33ef040780ee7cb44c7a85e0169"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#a3651b33ef040780ee7cb44c7a85e0169">goon</a> = 0</td></tr>
<tr class="memdesc:a3651b33ef040780ee7cb44c7a85e0169"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capture loop variable. Change to 1 if Ctrl+C (SIGINT) is entered.  <a href="webcam__capture_8cpp.html#a3651b33ef040780ee7cb44c7a85e0169">More...</a><br /></td></tr>
<tr class="separator:a3651b33ef040780ee7cb44c7a85e0169"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb5f90328f746a429516e6c9b1a069e2"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#afb5f90328f746a429516e6c9b1a069e2">name</a> [11] = &quot;img/webcam&quot;</td></tr>
<tr class="memdesc:afb5f90328f746a429516e6c9b1a069e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defined the directory and the name of the capture.  <a href="webcam__capture_8cpp.html#afb5f90328f746a429516e6c9b1a069e2">More...</a><br /></td></tr>
<tr class="separator:afb5f90328f746a429516e6c9b1a069e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6646dffa4596b4774a58e702780e669"><td class="memItemLeft" align="right" valign="top">const void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="webcam__capture_8cpp.html#ad6646dffa4596b4774a58e702780e669">save</a></td></tr>
<tr class="memdesc:ad6646dffa4596b4774a58e702780e669"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saved framebuffer in <a class="el" href="init_8cpp.html">init.cpp</a>.  <a href="webcam__capture_8cpp.html#ad6646dffa4596b4774a58e702780e669">More...</a><br /></td></tr>
<tr class="separator:ad6646dffa4596b4774a58e702780e669"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab3c43a0316dfc1464879b1bfabb2a340"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3c43a0316dfc1464879b1bfabb2a340">&#9670;&nbsp;</a></span>capture()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int capture </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main function of the project. </p>
<p>Get the wanted file descriptor<br  />
init: buffers, filename, signal<br  />
check function returns of start_capture, record_loop, stop_record<br  />
free buffers<br  />
close fd<br  />
 </p><dl class="section return"><dt>Returns</dt><dd>0 if everthing's fine, 1 if not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00192">192</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">int</span> fd = open(<span class="stringliteral">&quot;/dev/video0&quot;</span>, O_RDWR);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keyword">struct </span>buffer *buffers = NULL;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    buffers = (<span class="keyword">struct </span>buffer*)calloc(1, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">//do checks and init buffers, format | return nbr buffers</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">int</span> nbr_buffers = <a class="code" href="init_8cpp.html#ab504869b086ceb5d5c360e7bf1d8dd68">init_all</a>(fd, buffers);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (nbr_buffers &lt; 0)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">//get size of malloc for the file name .jpeg</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordtype">int</span> max_name_len = snprintf(NULL,0,FilenameFmt,jpegFilename,UINT32_MAX,INT64_MAX);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    jpegFilenamePart = jpegFilename;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    jpegFilename = (<span class="keywordtype">char</span> *)calloc(max_name_len+1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    strcpy(jpegFilename,jpegFilenamePart);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">//initialize the stop signal SIGINT to stop the record loop without buffering stdin</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="webcam__capture_8cpp.html#acac45d9c019293e46f9006d243135510">InstallSIGINTHandler</a>();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">//turn on the webcam if the buffers exists</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="webcam__capture_8cpp.html#ab5190a40848a190b9b55aa5ccdc9d2f0">start_capture</a>(fd, nbr_buffers) != 0)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">//start the record loop while goon == 0 and process each frames</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="webcam__capture_8cpp.html#a31d53d917c05d218ff61962df27dc9b4">record_loop</a>(fd) != 0)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">//stop the record if ctrl+c (SIGINT) is pressed</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="webcam__capture_8cpp.html#af82945ba52597baa86591d757c299a68">stop_record</a>(fd) != 0)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">//free all</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (jpegFilename != 0)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        free(jpegFilename);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    free(buffers);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    close(fd);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5e01bcf6b5022fc7d53e87dea3d93632"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e01bcf6b5022fc7d53e87dea3d93632">&#9670;&nbsp;</a></span>frameRead()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int frameRead </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write in a .jpg the saved buffer(frame). </p>
<p>the VIDIOC_DQBUF ioctl is used to dequeue a filled (capturing) or displayed (output) buffer from the driver’s outgoing queue.<br  />
The ofstream variable will be the final capture frame, with the jpegFilename which have been formatted before, thank's to timeval (time value) struct, 32 and 64 bits int, and sprintf function.<br  />
A new buffer is after queued for the next frame.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>webcam file descriptor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everthing's fine, 1 if not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00071">71</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    v4l2_buffer buf = {0};</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    ofstream outFile;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    CLEAR(buf);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    buf.memory = V4L2_MEMORY_MMAP;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="init_8cpp.html#a5f7db73debf87a2106ff5fe1af6f4dba">xioctl</a>(fd, VIDIOC_DQBUF, &amp;buf) == -1) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">switch</span> (errno) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keywordflow">case</span> EAGAIN:</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                perror(<span class="stringliteral">&quot;VIDIOC_DQBUF&quot;</span>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">//init timeval struct for .jpeg name update</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keyword">struct </span>timeval timestamp = buf.timestamp;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">static</span> uint32_t img_ind = 0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    int64_t timestamp_long;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    timestamp_long = timestamp.tv_sec*1e6 +  timestamp.tv_usec;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    sprintf(jpegFilename,FilenameFmt,jpegFilenamePart,img_ind++,timestamp_long);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">//write in .jpeg (open create the .jpeg, write fill it, and close)</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    outFile.open(jpegFilename);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    outFile.write((<span class="keywordtype">char</span>*)<a class="code" href="webcam__capture_8cpp.html#ad6646dffa4596b4774a58e702780e669">save</a>, (<span class="keywordtype">double</span>)buf.bytesused);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    outFile.close();</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="init_8cpp.html#a5f7db73debf87a2106ff5fe1af6f4dba">xioctl</a>(fd, VIDIOC_QBUF, &amp;buf) == -1)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        perror(<span class="stringliteral">&quot;VIDIOC_QBUF&quot;</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="acac45d9c019293e46f9006d243135510"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acac45d9c019293e46f9006d243135510">&#9670;&nbsp;</a></span>InstallSIGINTHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InstallSIGINTHandler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Catch sig_int signal if Ctrl+C is entered. </p>
<p>Sigaction strucure interpret the incoming signal (when it catch one) and if sig_int is recognize, transmit the info to StopContCapture(SIGINT). </p>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00048">48</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keyword">struct </span>sigaction sa;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    CLEAR(sa);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    sa.sa_handler = <a class="code" href="webcam__capture_8cpp.html#abc91e7fb5a5a6e02a812a21ef487477b">StopContCapture</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (sigaction(SIGINT, &amp;sa, 0) != 0)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;could not install SIGINT handler, continuous capture disabled&quot;</span>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a31d53d917c05d218ff61962df27dc9b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31d53d917c05d218ff61962df27dc9b4">&#9670;&nbsp;</a></span>record_loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int record_loop </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capture frames while Ctrl+C is not pressed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>webcam file descriptor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everthing's fine, 1 if not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00110">110</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;{</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    std::cout&lt;&lt;<span class="stringliteral">&quot;Capturing.. Press Ctrl+C to exit&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">for</span> (;<a class="code" href="webcam__capture_8cpp.html#a3651b33ef040780ee7cb44c7a85e0169">goon</a> == 0;) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="webcam__capture_8cpp.html#a5e01bcf6b5022fc7d53e87dea3d93632">frameRead</a>(fd))</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="webcam__capture_8cpp.html#a3651b33ef040780ee7cb44c7a85e0169">goon</a> == 1)</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="webcam__capture_8cpp.html#a3651b33ef040780ee7cb44c7a85e0169">goon</a> = 0;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5190a40848a190b9b55aa5ccdc9d2f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5190a40848a190b9b55aa5ccdc9d2f0">&#9670;&nbsp;</a></span>start_capture()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int start_capture </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start camera record (VIDIOC_STREAMON). </p>
<p>Applications call the VIDIOC_QBUF ioctl to enqueue an empty (capturing) or filled (output) buffer in the driver’s incoming queue.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>webcam file descriptor. </td></tr>
    <tr><td class="paramname">n</td><td>number of queued buffers needed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everthing's fine, 1 if not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00135">135</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keyword">enum</span> v4l2_buf_type type;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">//start capture for n_buffers</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; n; ++index) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keyword">struct </span>v4l2_buffer buf;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        CLEAR(buf);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        buf.memory = V4L2_MEMORY_MMAP;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        buf.index = index;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="init_8cpp.html#a5f7db73debf87a2106ff5fe1af6f4dba">xioctl</a>(fd, VIDIOC_QBUF, &amp;buf) == 1) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            perror(<span class="stringliteral">&quot;VIDIOC_QBUF&quot;</span>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    type = V4L2_BUF_TYPE_VIDEO_CAPTURE;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> (-1 == <a class="code" href="init_8cpp.html#a5f7db73debf87a2106ff5fe1af6f4dba">xioctl</a>(fd, VIDIOC_STREAMON, &amp;type)) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        perror(<span class="stringliteral">&quot;VIDIOC_STREAMON&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af82945ba52597baa86591d757c299a68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af82945ba52597baa86591d757c299a68">&#9670;&nbsp;</a></span>stop_record()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stop_record </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop camera record (VIDIOC_STREAMOFF) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>webcam file descriptor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everthing's fine, 1 if not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00166">166</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    v4l2_buf_type type;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">//stop streaming when SIGINT</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    type = V4L2_BUF_TYPE_VIDEO_CAPTURE;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="init_8cpp.html#a5f7db73debf87a2106ff5fe1af6f4dba">xioctl</a>(fd, VIDIOC_STREAMOFF, &amp;type) &lt; 0) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        perror(<span class="stringliteral">&quot;Could not end streaming, VIDIOC_STREAMOFF&quot;</span>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="abc91e7fb5a5a6e02a812a21ef487477b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc91e7fb5a5a6e02a812a21ef487477b">&#9670;&nbsp;</a></span>StopContCapture()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void StopContCapture </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop capture if sig_int signal is entered. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sig_id</td><td>signal ID. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section remark"><dt>Remarks</dt><dd>pass goon variable to 1 to interrupt capture loop. </dd></dl>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00033">33</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    UNUSED(sig_id);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    printf(<span class="stringliteral">&quot;\nStoping capture.\n&quot;</span>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="webcam__capture_8cpp.html#a3651b33ef040780ee7cb44c7a85e0169">goon</a> = 1;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3651b33ef040780ee7cb44c7a85e0169"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3651b33ef040780ee7cb44c7a85e0169">&#9670;&nbsp;</a></span>goon</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int goon = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capture loop variable. Change to 1 if Ctrl+C (SIGINT) is entered. </p>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00014">14</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>

</div>
</div>
<a id="afb5f90328f746a429516e6c9b1a069e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb5f90328f746a429516e6c9b1a069e2">&#9670;&nbsp;</a></span>name</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char name[11] = &quot;img/webcam&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defined the directory and the name of the capture. </p>

<p class="definition">Definition at line <a class="el" href="webcam__capture_8cpp_source.html#l00016">16</a> of file <a class="el" href="webcam__capture_8cpp_source.html">webcam_capture.cpp</a>.</p>

</div>
</div>
<a id="ad6646dffa4596b4774a58e702780e669"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6646dffa4596b4774a58e702780e669">&#9670;&nbsp;</a></span>save</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void* save</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Saved framebuffer in <a class="el" href="init_8cpp.html">init.cpp</a>. </p>

<p class="definition">Definition at line <a class="el" href="init_8cpp_source.html#l00013">13</a> of file <a class="el" href="init_8cpp_source.html">init.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="awebcam__capture_8cpp_html_a3651b33ef040780ee7cb44c7a85e0169"><div class="ttname"><a href="webcam__capture_8cpp.html#a3651b33ef040780ee7cb44c7a85e0169">goon</a></div><div class="ttdeci">int goon</div><div class="ttdoc">Capture loop variable. Change to 1 if Ctrl+C (SIGINT) is entered.</div><div class="ttdef"><b>Definition:</b> <a href="webcam__capture_8cpp_source.html#l00014">webcam_capture.cpp:14</a></div></div>
<div class="ttc" id="awebcam__capture_8cpp_html_ad6646dffa4596b4774a58e702780e669"><div class="ttname"><a href="webcam__capture_8cpp.html#ad6646dffa4596b4774a58e702780e669">save</a></div><div class="ttdeci">const void * save</div><div class="ttdoc">Saved framebuffer in init.cpp.</div><div class="ttdef"><b>Definition:</b> <a href="init_8cpp_source.html#l00013">init.cpp:13</a></div></div>
<div class="ttc" id="ainit_8cpp_html_ab504869b086ceb5d5c360e7bf1d8dd68"><div class="ttname"><a href="init_8cpp.html#ab504869b086ceb5d5c360e7bf1d8dd68">init_all</a></div><div class="ttdeci">int init_all(int fd, struct buffer *buffers)</div><div class="ttdoc">Global initialize function (check functions return)</div><div class="ttdef"><b>Definition:</b> <a href="init_8cpp_source.html#l00163">init.cpp:163</a></div></div>
<div class="ttc" id="awebcam__capture_8cpp_html_ab5190a40848a190b9b55aa5ccdc9d2f0"><div class="ttname"><a href="webcam__capture_8cpp.html#ab5190a40848a190b9b55aa5ccdc9d2f0">start_capture</a></div><div class="ttdeci">int start_capture(int fd, int n)</div><div class="ttdoc">Start camera record (VIDIOC_STREAMON).</div><div class="ttdef"><b>Definition:</b> <a href="webcam__capture_8cpp_source.html#l00135">webcam_capture.cpp:135</a></div></div>
<div class="ttc" id="ainit_8cpp_html_a5f7db73debf87a2106ff5fe1af6f4dba"><div class="ttname"><a href="init_8cpp.html#a5f7db73debf87a2106ff5fe1af6f4dba">xioctl</a></div><div class="ttdeci">int xioctl(int fd, long unsigned int request, void *argp)</div><div class="ttdoc">Do ioctl and retry if error was EINTR, same parameters as ioctl.</div><div class="ttdef"><b>Definition:</b> <a href="init_8cpp_source.html#l00025">init.cpp:25</a></div></div>
<div class="ttc" id="awebcam__capture_8cpp_html_a5e01bcf6b5022fc7d53e87dea3d93632"><div class="ttname"><a href="webcam__capture_8cpp.html#a5e01bcf6b5022fc7d53e87dea3d93632">frameRead</a></div><div class="ttdeci">int frameRead(int fd)</div><div class="ttdoc">Write in a .jpg the saved buffer(frame).</div><div class="ttdef"><b>Definition:</b> <a href="webcam__capture_8cpp_source.html#l00071">webcam_capture.cpp:71</a></div></div>
<div class="ttc" id="awebcam__capture_8cpp_html_abc91e7fb5a5a6e02a812a21ef487477b"><div class="ttname"><a href="webcam__capture_8cpp.html#abc91e7fb5a5a6e02a812a21ef487477b">StopContCapture</a></div><div class="ttdeci">void StopContCapture(int sig_id)</div><div class="ttdoc">Stop capture if sig_int signal is entered.</div><div class="ttdef"><b>Definition:</b> <a href="webcam__capture_8cpp_source.html#l00033">webcam_capture.cpp:33</a></div></div>
<div class="ttc" id="awebcam__capture_8cpp_html_acac45d9c019293e46f9006d243135510"><div class="ttname"><a href="webcam__capture_8cpp.html#acac45d9c019293e46f9006d243135510">InstallSIGINTHandler</a></div><div class="ttdeci">void InstallSIGINTHandler()</div><div class="ttdoc">Catch sig_int signal if Ctrl+C is entered.</div><div class="ttdef"><b>Definition:</b> <a href="webcam__capture_8cpp_source.html#l00048">webcam_capture.cpp:48</a></div></div>
<div class="ttc" id="awebcam__capture_8cpp_html_a31d53d917c05d218ff61962df27dc9b4"><div class="ttname"><a href="webcam__capture_8cpp.html#a31d53d917c05d218ff61962df27dc9b4">record_loop</a></div><div class="ttdeci">int record_loop(int fd)</div><div class="ttdoc">Capture frames while Ctrl+C is not pressed.</div><div class="ttdef"><b>Definition:</b> <a href="webcam__capture_8cpp_source.html#l00110">webcam_capture.cpp:110</a></div></div>
<div class="ttc" id="awebcam__capture_8cpp_html_af82945ba52597baa86591d757c299a68"><div class="ttname"><a href="webcam__capture_8cpp.html#af82945ba52597baa86591d757c299a68">stop_record</a></div><div class="ttdeci">int stop_record(int fd)</div><div class="ttdoc">Stop camera record (VIDIOC_STREAMOFF)</div><div class="ttdef"><b>Definition:</b> <a href="webcam__capture_8cpp_source.html#l00166">webcam_capture.cpp:166</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
